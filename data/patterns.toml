# traur pattern database
# Each section corresponds to a feature name.
# Patterns are regular expressions matched against file content.

[[pkgbuild_analysis]]
id = "P-CURL-PIPE"
pattern = 'curl\s[^|]*\|\s*(ba)?sh'
points = 90
description = "curl output piped to shell (download-and-execute)"
override_gate = true

[[pkgbuild_analysis]]
id = "P-WGET-PIPE"
pattern = 'wget\s[^|]*\|\s*(ba)?sh'
points = 90
description = "wget output piped to shell (download-and-execute)"
override_gate = true

[[pkgbuild_analysis]]
id = "P-REVSHELL-DEVTCP"
pattern = '/dev/tcp/'
points = 95
description = "Bash reverse shell via /dev/tcp"
override_gate = true

[[pkgbuild_analysis]]
id = "P-REVSHELL-NC"
pattern = '(nc|ncat)\s+(-e|-c)\s'
points = 95
description = "Netcat reverse shell"
override_gate = true

[[pkgbuild_analysis]]
id = "P-REVSHELL-SOCAT"
pattern = 'socat\s.*TCP.*EXEC'
points = 90
description = "Socat reverse shell"
override_gate = true

[[pkgbuild_analysis]]
id = "P-REVSHELL-PYTHON"
pattern = 'socket\..*connect.*subprocess'
points = 85
description = "Python reverse shell pattern"
override_gate = true

[[pkgbuild_analysis]]
id = "P-EVAL-BASE64"
pattern = '(eval.*base64|base64.*eval)'
points = 85
description = "Base64-decoded payload executed via eval"
override_gate = false

[[pkgbuild_analysis]]
id = "P-BASE64"
pattern = 'base64\s+(-d|--decode)'
points = 60
description = "Base64 decoding (possible payload hiding)"
override_gate = false

[[pkgbuild_analysis]]
id = "P-EVAL-VAR"
pattern = 'eval\s+["$]'
points = 50
description = "Dynamic code execution via eval"
override_gate = false

[[pkgbuild_analysis]]
id = "P-SOURCE-REMOTE"
pattern = '(source|\.)\s+<\(curl'
points = 90
description = "Sourcing remote script via process substitution"
override_gate = true

[[pkgbuild_analysis]]
id = "P-GZIP-EXEC"
pattern = '(gunzip|zcat)\s.*\|\s*(ba)?sh'
points = 70
description = "Compressed payload piped to shell"
override_gate = false

[[pkgbuild_analysis]]
id = "P-SSH-ACCESS"
pattern = '~/\.ssh/|/home/[^/]+/\.ssh/'
points = 75
description = "Accessing SSH keys"
override_gate = false

[[pkgbuild_analysis]]
id = "P-BROWSER-DATA"
pattern = '\.(mozilla|config/chromium|config/google-chrome|config/BraveSoftware)/'
points = 70
description = "Accessing browser profile data"
override_gate = false

[[pkgbuild_analysis]]
id = "P-GPG-ACCESS"
pattern = '~/\.gnupg/|/home/[^/]+/\.gnupg/'
points = 65
description = "Accessing GPG keyring"
override_gate = false

[[pkgbuild_analysis]]
id = "P-PROFILE-MOD"
pattern = '(>>?\s*~/\.(bashrc|zshrc|profile|bash_profile))'
points = 55
description = "Modifying shell profile (persistence)"
override_gate = false

[[pkgbuild_analysis]]
id = "P-SYSTEMD-CREATE"
pattern = 'install.*\.service.*systemd|systemctl\s+enable'
points = 35
description = "Creating/enabling systemd service"
override_gate = false

[[pkgbuild_analysis]]
id = "P-CRON-CREATE"
pattern = 'crontab|/etc/cron\.d/'
points = 45
description = "Creating cron job (persistence)"
override_gate = false

[[pkgbuild_analysis]]
id = "P-LD-PRELOAD"
pattern = 'LD_PRELOAD\s*='
points = 60
description = "LD_PRELOAD injection"
override_gate = false

[[pkgbuild_analysis]]
id = "P-PASSWD-READ"
pattern = '/etc/(passwd|shadow)'
points = 60
description = "Reading system password files"
override_gate = false

[[pkgbuild_analysis]]
id = "P-DISCORD-WEBHOOK"
pattern = 'discord(app)?\.com/api/webhooks/'
points = 70
description = "Discord webhook URL (data exfiltration channel)"
override_gate = false

[[pkgbuild_analysis]]
id = "P-URL-SHORTENER"
pattern = '(bit\.ly|tinyurl\.com|t\.co|is\.gd|v\.gd|short\.io)/'
points = 60
description = "URL shortener (hiding real destination)"
override_gate = false

[[pkgbuild_analysis]]
id = "P-CURL-PIPE-PYTHON"
pattern = 'curl\s[^|]*\|\s*python[23]?'
points = 90
description = "curl output piped to Python interpreter (download-and-execute)"
override_gate = true

[[pkgbuild_analysis]]
id = "P-CURL-PIPE-PERL"
pattern = 'curl\s[^|]*\|\s*perl'
points = 90
description = "curl output piped to Perl interpreter (download-and-execute)"
override_gate = true

[[pkgbuild_analysis]]
id = "P-WGET-PIPE-PYTHON"
pattern = 'wget\s[^|]*\|\s*python[23]?'
points = 90
description = "wget output piped to Python interpreter (download-and-execute)"
override_gate = true

[[pkgbuild_analysis]]
id = "P-PYTHON-INLINE"
pattern = "python[23]?\\s+-c\\s+[\"']"
points = 45
description = "Python inline code execution"
override_gate = false

[[pkgbuild_analysis]]
id = "P-SUID-BIT"
pattern = 'chmod\s+[ugo]*\+s\s|chmod\s+[0-7]*[4-7][0-7]{2}\s'
points = 70
description = "Setting SUID/SGID bit (privilege escalation)"
override_gate = false

[[pkgbuild_analysis]]
id = "P-MKFIFO"
pattern = 'mkfifo\s'
points = 55
description = "Named pipe creation (possible reverse shell component)"
override_gate = false

[[pkgbuild_analysis]]
id = "P-OPENSSL-CLIENT"
pattern = 'openssl\s+s_client'
points = 55
description = "OpenSSL client connection (possible encrypted C2 channel)"
override_gate = false

[[pkgbuild_analysis]]
id = "P-CLIPBOARD-READ"
pattern = '(xclip|xsel|wl-paste)\s'
points = 50
description = "Clipboard access (possible credential theft)"
override_gate = false

[[pkgbuild_analysis]]
id = "P-DISK-READ"
pattern = 'dd\s+if=/dev/sd'
points = 60
description = "Direct disk device read (data exfiltration)"
override_gate = false

# Cryptocurrency mining
[[pkgbuild_analysis]]
id = "P-MINER-BINARY"
pattern = '(xmrig|cpuminer|minerd|ethminer|bfgminer|cgminer|nbminer|phoenixminer|lolminer|gminer|teamredminer)'
points = 70
description = "Reference to cryptocurrency mining software"
override_gate = false

[[pkgbuild_analysis]]
id = "P-STRATUM-URL"
pattern = 'stratum\+[a-z]+://'
points = 85
description = "Stratum mining protocol URL (cryptocurrency mining)"
override_gate = false

[[pkgbuild_analysis]]
id = "P-MINING-POOL"
pattern = '(pool\.minergate|nanopool\.org|2miners\.com|f2pool\.com|ethermine\.org|nicehash\.com|miningpoolhub\.com|unmineable\.com|hashvault\.pro|moneroocean\.stream)'
points = 80
description = "Known cryptocurrency mining pool domain"
override_gate = false

[[pkgbuild_analysis]]
id = "P-CRYPTO-WALLET"
pattern = '(4[0-9AB][1-9A-HJ-NP-Za-km-z]{93}|bc1[a-zA-HJ-NP-Z0-9]{39,59}|0x[0-9a-fA-F]{40})'
points = 75
description = "Cryptocurrency wallet address (Monero/Bitcoin/Ethereum)"
override_gate = false

# Python remote code execution
[[pkgbuild_analysis]]
id = "P-PYTHON-EXEC-URL"
pattern = 'exec\s*\(\s*(urlopen|requests\.get|urllib)'
points = 90
description = "Python fetch-and-execute (exec with URL fetch)"
override_gate = true

[[pkgbuild_analysis]]
id = "P-PYTHON-DYNAMIC-IMPORT"
pattern = "__import__\\s*\\(\\s*['\"]os['\"]\\s*\\)\\s*\\.\\s*system"
points = 65
description = "Python dynamic import to execute system commands"
override_gate = false

[[pkgbuild_analysis]]
id = "P-PYTHON-EXEC-COMPOUND"
pattern = 'python[23]?\s+.*-c\s+.*exec\s*\('
points = 80
description = "Python one-liner with exec() (obfuscated code execution)"
override_gate = false

# Download-chmod-execute chains
[[pkgbuild_analysis]]
id = "P-CHMOD-EXEC-CHAIN"
pattern = 'chmod\s+\+x\s+\S+\s*[;&|]+\s*\./'
points = 75
description = "chmod +x followed by execution (download-chmod-execute chain)"
override_gate = false

[[pkgbuild_analysis]]
id = "P-WGET-CHMOD-EXEC"
pattern = '(curl|wget)\s[^;&|]*\S+\s*[;&|]+\s*chmod\s+\+x'
points = 85
description = "Download followed by chmod +x (download-and-execute preparation)"
override_gate = false

# /tmp staging
[[pkgbuild_analysis]]
id = "P-TMP-EXECUTION"
pattern = '(chmod\s+\+x\s+/tmp/|>\s*/tmp/\S+\s*[;&|]+\s*(ba)?sh\s+/tmp/)'
points = 70
description = "Writing or executing files in /tmp (common malware staging)"
override_gate = false

# Process backgrounding/hiding
[[pkgbuild_analysis]]
id = "P-NOHUP-BACKGROUND"
pattern = 'nohup\s+\S+.*&'
points = 55
description = "nohup with backgrounding (persistent hidden process)"
override_gate = false

[[pkgbuild_analysis]]
id = "P-DEVNULL-BACKGROUND"
pattern = '(curl|wget|python[23]?|bash|sh)\s+.*>/dev/null.*&'
points = 65
description = "Network/shell command backgrounded with suppressed output"
override_gate = false

# System reconnaissance
[[pkgbuild_analysis]]
id = "P-SYSINFO-RECON"
pattern = '(uname\s+-a|cat\s+/proc/cpuinfo|lspci|ip\s+addr|hostname\s+-[fI]|cat\s+/etc/machine-id|dmidecode)'
points = 40
description = "System information gathering (reconnaissance)"
override_gate = false

# Hex/octal obfuscation
[[pkgbuild_analysis]]
id = "P-PRINTF-HEX"
pattern = 'printf\s+.*(\\x[0-9a-fA-F]{2}){4,}'
points = 60
description = "printf with hex escape sequences (obfuscated payload)"
override_gate = false

[[pkgbuild_analysis]]
id = "P-XXD-DECODE"
pattern = 'xxd\s+(-r|-revert)'
points = 55
description = "xxd reverse (hex to binary decode, possible payload)"
override_gate = false

# Kernel module / rootkit
[[pkgbuild_analysis]]
id = "P-KERNEL-MODULE-LOAD"
pattern = '(insmod|modprobe)\s+[^-]'
points = 50
description = "Kernel module loading (potential rootkit)"
override_gate = false

[[pkgbuild_analysis]]
id = "P-KERNEL-MODULE-WRITE"
pattern = '/lib/modules/|/etc/modules-load\.d/'
points = 45
description = "Writing to kernel module directories"
override_gate = false

# Pastebin URLs in PKGBUILD body (not just source array)
[[pkgbuild_analysis]]
id = "P-PASTEBIN-CODE"
pattern = '(curl|wget)\s+[^;|&]*(pastebin\.com|paste\.ee|hastebin\.com|ptpb\.pw|ix\.io|dpaste\.com|ghostbin\.com|rentry\.co|termbin\.com)'
points = 75
description = "Downloading from paste service in build/package code (mutable untrusted source)"
override_gate = false

# DNS/HTTP exfiltration
[[pkgbuild_analysis]]
id = "P-DNS-EXFIL"
pattern = '(dig|nslookup|host)\s+\$'
points = 60
description = "DNS lookup with variable interpolation (possible DNS exfiltration)"
override_gate = false

[[pkgbuild_analysis]]
id = "P-CURL-POST-DATA"
pattern = 'curl\s+[^;|&]*(-d\s+\$|--data[^;|&]*\$|-X\s+POST[^;|&]*\$)'
points = 55
description = "curl POST with variable data (possible data exfiltration)"
override_gate = false

# Archive extract-and-execute
[[pkgbuild_analysis]]
id = "P-ARCHIVE-EXEC"
pattern = '(tar\s+[^;|&]*-?x[^;|&]*|unzip\s+[^;|&]*)[;&|]+\s*(\./|chmod\s+\+x)'
points = 55
description = "Archive extraction followed by execution (extract-and-execute chain)"
override_gate = false

# Environment variable theft
[[pkgbuild_analysis]]
id = "P-ENV-TOKEN-ACCESS"
pattern = '\$(AWS_SECRET_ACCESS_KEY|AWS_ACCESS_KEY_ID|GITHUB_TOKEN|GH_TOKEN|GITLAB_TOKEN|NPM_TOKEN|DOCKER_PASSWORD|API_KEY|SECRET_KEY|PRIVATE_KEY|DATABASE_URL|SLACK_TOKEN|DISCORD_TOKEN)'
points = 55
description = "Accessing sensitive environment variables (token/credential theft)"
override_gate = false

# Shell obfuscation
[[pkgbuild_analysis]]
id = "P-IFS-OBFUSCATION"
pattern = '\$\{?IFS\}?'
points = 60
description = "$IFS variable used as command separator (shell obfuscation)"
override_gate = false

[[pkgbuild_analysis]]
id = "P-ANSI-C-HEX"
pattern = '''\$'\\x[0-9a-fA-F]{2}'''
points = 65
description = "ANSI-C hex quoting to hide command strings"
override_gate = false

[[pkgbuild_analysis]]
id = "P-ROT13"
pattern = 'tr\s.*n-za-m'
points = 60
description = "ROT13 encoding/decoding (payload obfuscation)"
override_gate = false

[[pkgbuild_analysis]]
id = "P-OCTAL-ENCODE"
pattern = '(printf|echo\s+-e)\s+.*\\[0-7]{3}.*\\[0-7]{3}.*\\[0-7]{3}'
points = 55
description = "Octal-encoded payload in printf/echo (3+ sequences)"
override_gate = false

[[pkgbuild_analysis]]
id = "P-REV-EXEC"
pattern = 'rev\s.*\|\s*(ba)?sh'
points = 70
description = "Reversed string piped to shell (obfuscation)"
override_gate = false

# Reverse shells - additional languages
[[pkgbuild_analysis]]
id = "P-REVSHELL-PERL"
pattern = 'perl\s.*Socket.*connect|perl\s.*INET.*exec'
points = 85
description = "Perl reverse shell (Socket + connect/exec)"
override_gate = true

[[pkgbuild_analysis]]
id = "P-REVSHELL-RUBY"
pattern = 'ruby\s.*TCPSocket'
points = 85
description = "Ruby reverse shell (TCPSocket)"
override_gate = true

[[pkgbuild_analysis]]
id = "P-REVSHELL-AWK"
pattern = 'awk\s.*/inet/tcp'
points = 85
description = "Awk reverse shell (/inet/tcp)"
override_gate = true

[[pkgbuild_analysis]]
id = "P-REVSHELL-LUA"
pattern = 'lua\s.*socket\.tcp|lua.*socket.*connect'
points = 85
description = "Lua reverse shell (socket.tcp)"
override_gate = true

[[pkgbuild_analysis]]
id = "P-REVSHELL-PHP"
pattern = 'php\s.*fsockopen|php.*socket_connect'
points = 85
description = "PHP reverse shell (fsockopen/socket_connect)"
override_gate = true

# Download-and-execute variants
[[pkgbuild_analysis]]
id = "P-DECOMPRESS-EXEC"
pattern = '(bunzip2|bzcat|xzcat|unxz|lzcat|zstdcat|lz4cat)\s.*\|\s*(ba)?sh'
points = 70
description = "Decompressed payload piped to shell"
override_gate = false

[[pkgbuild_analysis]]
id = "P-PROC-SUB-DOWNLOAD"
pattern = '<\(\s*(curl|wget)\s'
points = 75
description = "Process substitution with download command"
override_gate = false

[[pkgbuild_analysis]]
id = "P-RUBY-EXEC-URL"
pattern = 'ruby.*(Net::HTTP|open-uri|URI\.open).*(eval|exec|system)|ruby.*(eval|exec|system).*(Net::HTTP|open-uri|URI\.open)'
points = 85
description = "Ruby fetch-and-execute"
override_gate = true

[[pkgbuild_analysis]]
id = "P-PERL-EXEC-URL"
pattern = 'perl.*LWP.*(system|exec)|perl.*HTTP::Tiny.*(system|exec)'
points = 85
description = "Perl fetch-and-execute (LWP/HTTP::Tiny + system/exec)"
override_gate = true

[[pkgbuild_analysis]]
id = "P-DEV-UDP"
pattern = '/dev/udp/'
points = 85
description = "Bash /dev/udp network connection"
override_gate = true

# Encoding bypasses
[[pkgbuild_analysis]]
id = "P-BASE32"
pattern = 'base32\s+(-d|--decode)'
points = 60
description = "Base32 decoding (payload hiding)"
override_gate = false

[[pkgbuild_analysis]]
id = "P-OPENSSL-DECRYPT"
pattern = 'openssl\s+(enc|aes-256-cbc|des|bf)\s.*-d'
points = 65
description = "OpenSSL decryption (encrypted payload)"
override_gate = false

[[pkgbuild_analysis]]
id = "P-TELNET-PIPE"
pattern = 'telnet\s+\S+\s+\d+\s*\|'
points = 70
description = "Telnet connection piped to command"
override_gate = false

# Persistence mechanisms
[[pkgbuild_analysis]]
id = "P-XDG-AUTOSTART"
pattern = '\.config/autostart'
points = 55
description = "XDG autostart entry creation"
override_gate = false

[[pkgbuild_analysis]]
id = "P-SYSTEMD-USER"
pattern = '\.config/systemd/user/'
points = 50
description = "Systemd user service creation (no root required)"
override_gate = false

[[pkgbuild_analysis]]
id = "P-UDEV-RULE"
pattern = '/etc/udev/rules\.d/'
points = 45
description = "Udev rule creation"
override_gate = false

[[pkgbuild_analysis]]
id = "P-AT-JOB"
pattern = '\bat\s+(now|midnight|noon|teatime|\d{1,2}:\d{2})'
points = 60
description = "at job scheduling (deferred execution)"
override_gate = false

[[pkgbuild_analysis]]
id = "P-PROMPT-COMMAND"
pattern = 'PROMPT_COMMAND\s*='
points = 65
description = "PROMPT_COMMAND injection (runs on every prompt)"
override_gate = false

[[pkgbuild_analysis]]
id = "P-BASH-LOGOUT"
pattern = '\.bash_logout'
points = 55
description = ".bash_logout modification (runs on session exit)"
override_gate = false

# Privilege escalation
[[pkgbuild_analysis]]
id = "P-SUDOERS-MOD"
pattern = '/etc/sudoers'
points = 75
description = "Sudoers file access/modification"
override_gate = false

[[pkgbuild_analysis]]
id = "P-POLKIT-RULE"
pattern = '/etc/polkit-1/rules\.d/'
points = 55
description = "Polkit rule creation"
override_gate = false

[[pkgbuild_analysis]]
id = "P-SETCAP"
pattern = 'setcap\s+cap_'
points = 65
description = "Linux capability manipulation"
override_gate = false

# Anti-forensics
[[pkgbuild_analysis]]
id = "P-HISTORY-CLEAR"
pattern = 'unset\s+HISTFILE|HISTFILE=/dev/null|history\s+-c|set\s+\+o\s+history'
points = 70
description = "Shell history clearing/suppression"
override_gate = false

[[pkgbuild_analysis]]
id = "P-LOG-CLEAR"
pattern = 'rm\s+(-[rf]+\s+)?/var/log|truncate\s+.*\s+/var/log|>\s*/var/log/'
points = 75
description = "System log clearing/truncation"
override_gate = false

# AUR-specific and other
[[pkgbuild_analysis]]
id = "P-PACMAN-HOOK"
pattern = '/usr/share/libalpm/hooks/|/etc/pacman\.d/hooks/'
points = 50
description = "Pacman hook creation (unusual for AUR packages)"
override_gate = false

[[pkgbuild_analysis]]
id = "P-DD-WRITE"
pattern = 'dd\s+.*of=/dev/'
points = 70
description = "dd writing to device file"
override_gate = false

[[pkgbuild_analysis]]
id = "P-ALIAS-OVERRIDE"
pattern = 'alias\s+(ls|cat|cd|rm|mv|cp|sudo|su|passwd|login|ssh)='
points = 65
description = "Alias override of common system commands"
override_gate = false

# Install script patterns
[[install_script_analysis]]
id = "P-INSTALL-CURL"
pattern = 'curl\s'
points = 45
description = "curl in install script (should not download during install)"
override_gate = false

[[install_script_analysis]]
id = "P-INSTALL-WGET"
pattern = 'wget\s'
points = 45
description = "wget in install script (should not download during install)"
override_gate = false

[[install_script_analysis]]
id = "P-INSTALL-PIPE-SHELL"
pattern = 'curl[^|]*\|\s*(ba)?sh|wget[^|]*\|\s*(ba)?sh'
points = 90
description = "Download-and-execute in install script"
override_gate = true

[[install_script_analysis]]
id = "P-INSTALL-PERSISTENCE"
pattern = 'systemctl\s+enable|crontab|/etc/cron\.d/'
points = 45
description = "Persistence mechanism in install script"
override_gate = false

[[install_script_analysis]]
id = "P-INSTALL-PROFILE-MOD"
pattern = '>>?\s*~/\.(bashrc|zshrc|profile)'
points = 55
description = "Shell profile modification in install script"
override_gate = false

[[install_script_analysis]]
id = "P-INSTALL-SSH-ACCESS"
pattern = '~/\.ssh/|/home/[^/]+/\.ssh/'
points = 80
description = "Accessing SSH keys from install script"
override_gate = false

[[install_script_analysis]]
id = "P-INSTALL-BROWSER-DATA"
pattern = '\.(mozilla|config/chromium|config/google-chrome|config/BraveSoftware)/'
points = 75
description = "Accessing browser profile data from install script"
override_gate = false

[[install_script_analysis]]
id = "P-INSTALL-GPG-ACCESS"
pattern = '~/\.gnupg/|/home/[^/]+/\.gnupg/'
points = 70
description = "Accessing GPG keyring from install script"
override_gate = false

[[install_script_analysis]]
id = "P-INSTALL-PASSWD-READ"
pattern = '/etc/(passwd|shadow)'
points = 65
description = "Reading system password files from install script"
override_gate = false

[[install_script_analysis]]
id = "P-INSTALL-BASE64"
pattern = 'base64\s+(-d|--decode)'
points = 65
description = "Base64 decoding in install script (possible payload hiding)"
override_gate = false

[[install_script_analysis]]
id = "P-INSTALL-EVAL"
pattern = 'eval\s+["$]'
points = 55
description = "Dynamic code execution via eval in install script"
override_gate = false

[[install_script_analysis]]
id = "P-INSTALL-NOHUP"
pattern = 'nohup\s+\S+.*&'
points = 75
description = "nohup with backgrounding in install script (persistent hidden process)"
override_gate = false

[[install_script_analysis]]
id = "P-INSTALL-TMP-EXEC"
pattern = '(chmod\s+\+x\s+/tmp/|>\s*/tmp/\S+\s*[;&|]+\s*(ba)?sh\s+/tmp/)'
points = 80
description = "Executing from /tmp in install script"
override_gate = false

[[install_script_analysis]]
id = "P-INSTALL-CHMOD-EXEC"
pattern = 'chmod\s+\+x\s+\S+\s*[;&|]+\s*\./'
points = 80
description = "chmod +x followed by execution in install script"
override_gate = false

[[install_script_analysis]]
id = "P-INSTALL-PYTHON-EXEC"
pattern = 'exec\s*\(\s*(urlopen|requests\.get|urllib)'
points = 90
description = "Python fetch-and-execute in install script"
override_gate = true

[[install_script_analysis]]
id = "P-INSTALL-DEVNULL-BG"
pattern = '(curl|wget|python[23]?|bash|sh)\s+.*>/dev/null.*&'
points = 75
description = "Network/shell command backgrounded with suppressed output in install script"
override_gate = false

[[install_script_analysis]]
id = "P-INSTALL-MINER"
pattern = '(xmrig|cpuminer|minerd|ethminer|stratum\+[a-z]+://)'
points = 85
description = "Cryptocurrency mining references in install script"
override_gate = false

[[install_script_analysis]]
id = "P-INSTALL-KERNEL-MOD"
pattern = '(insmod|modprobe)\s+[^-]'
points = 70
description = "Kernel module loading in install script"
override_gate = false

[[install_script_analysis]]
id = "P-INSTALL-ENV-TOKENS"
pattern = '\$(AWS_SECRET_ACCESS_KEY|AWS_ACCESS_KEY_ID|GITHUB_TOKEN|GH_TOKEN|GITLAB_TOKEN|NPM_TOKEN|DOCKER_PASSWORD|API_KEY|SECRET_KEY|PRIVATE_KEY|SLACK_TOKEN|DISCORD_TOKEN)'
points = 65
description = "Accessing sensitive environment variables in install script"
override_gate = false

[[install_script_analysis]]
id = "P-INSTALL-IFS"
pattern = '\$\{?IFS\}?'
points = 65
description = "$IFS used in install script (obfuscation)"
override_gate = false

[[install_script_analysis]]
id = "P-INSTALL-ANSI-C-HEX"
pattern = '''\$'\\x[0-9a-fA-F]{2}'''
points = 70
description = "ANSI-C hex quoting in install script"
override_gate = false

[[install_script_analysis]]
id = "P-INSTALL-ROT13"
pattern = 'tr\s.*n-za-m'
points = 65
description = "ROT13 encoding in install script"
override_gate = false

[[install_script_analysis]]
id = "P-INSTALL-HISTORY-CLEAR"
pattern = 'unset\s+HISTFILE|HISTFILE=/dev/null|history\s+-c|set\s+\+o\s+history'
points = 75
description = "Shell history clearing in install script"
override_gate = false

[[install_script_analysis]]
id = "P-INSTALL-LOG-CLEAR"
pattern = 'rm\s+(-[rf]+\s+)?/var/log|truncate\s+.*\s+/var/log|>\s*/var/log/'
points = 80
description = "Log clearing in install script"
override_gate = false

[[install_script_analysis]]
id = "P-INSTALL-SUDOERS-MOD"
pattern = '/etc/sudoers'
points = 80
description = "Sudoers access in install script"
override_gate = false

[[install_script_analysis]]
id = "P-INSTALL-PROMPT-COMMAND"
pattern = 'PROMPT_COMMAND\s*='
points = 70
description = "PROMPT_COMMAND injection from install script"
override_gate = false

[[install_script_analysis]]
id = "P-INSTALL-XDG-AUTOSTART"
pattern = '\.config/autostart'
points = 60
description = "XDG autostart creation from install script"
override_gate = false

# Source URL patterns
[[source_url_analysis]]
id = "P-RAW-IP-URL"
pattern = 'https?://\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}'
points = 50
description = "Source URL uses raw IP address instead of domain"
override_gate = false

[[source_url_analysis]]
id = "P-URL-SHORTENER"
pattern = '(bit\.ly|tinyurl\.com|t\.co|is\.gd|v\.gd|short\.io)/'
points = 60
description = "Source URL uses URL shortener (hiding real destination)"
override_gate = false

[[source_url_analysis]]
id = "P-DISCORD-WEBHOOK"
pattern = 'discord(app)?\.com/api/webhooks/'
points = 70
description = "Discord webhook URL (data exfiltration channel)"
override_gate = false

[[source_url_analysis]]
id = "P-PASTEBIN"
pattern = '(pastebin\.com|paste\.ee|hastebin\.com|ptpb\.pw|ix\.io)/'
points = 50
description = "Source from paste service (untrusted, mutable content)"
override_gate = false

[[source_url_analysis]]
id = "P-DYNAMIC-DNS"
pattern = '(duckdns\.org|no-ip\.com|ddns\.net|dynu\.com)/'
points = 55
description = "Source uses dynamic DNS (common in C2 infrastructure)"
override_gate = false

[[source_url_analysis]]
id = "P-TELEGRAM-BOT"
pattern = '(telegram\.org/bot|api\.telegram\.org/bot)'
points = 65
description = "Telegram bot API URL (data exfiltration channel)"
override_gate = false

[[source_url_analysis]]
id = "P-TUNNEL-SERVICE"
pattern = '(ngrok\.io|serveo\.net|localtunnel\.me|localhost\.run)/'
points = 55
description = "Tunnel service URL (obfuscated endpoint)"
override_gate = false

[[source_url_analysis]]
id = "P-HTTP-SOURCE"
pattern = 'http://[^$\s]'
points = 15
description = "Plain HTTP source URL (no TLS, MITM risk)"
override_gate = false

[[source_url_analysis]]
id = "P-FILEHOST-SOURCE"
pattern = '(anonfiles\.com|file\.io|transfer\.sh|tmpfiles\.org|gofile\.io|pixeldrain\.com|mediafire\.com)'
points = 45
description = "Source from ephemeral/anonymous file hosting (untrusted, mutable content)"
override_gate = false

[[source_url_analysis]]
id = "P-ONION-SOURCE"
pattern = '\.onion[/:]'
points = 65
description = "Source URL points to Tor hidden service"
override_gate = false

[[source_url_analysis]]
id = "P-MEGA-SOURCE"
pattern = '(mega\.nz|mega\.co\.nz)/'
points = 40
description = "Source from MEGA file hosting (encrypted, unverifiable)"
override_gate = false
